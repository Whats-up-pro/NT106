<Window x:Class="ThreeMess.AddFriendWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        Title="Kết bạn" Height="420" Width="520"
        ResizeMode="NoResize"
        WindowStartupLocation="CenterOwner">

    <Grid Background="#FFF5F6F8" Margin="12">
        <Border CornerRadius="16" Background="#FFF3F4F6" Padding="12">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>

                <TextBlock Text="Kết bạn" FontWeight="SemiBold" FontSize="16" Foreground="#FF111827" />

                <TabControl Grid.Row="1" Margin="0,10,0,0" Background="Transparent" BorderThickness="0">
                    <TabItem Header="Tìm kiếm">
                        <Grid Margin="0,8,0,0">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="*" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>

                            <Border Grid.Row="0" Background="White" CornerRadius="12" Padding="10" BorderBrush="#FFE5E7EB" BorderThickness="1">
                                <DockPanel LastChildFill="True">
                                    <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE721;" Foreground="#FF6B7280" FontSize="16" Margin="0,0,8,0" VerticalAlignment="Center" />

                                    <Button DockPanel.Dock="Right"
                                            Width="84" Height="28" Margin="8,0,0,0"
                                            Background="#FFF9FAFB" BorderBrush="#FFE5E7EB" BorderThickness="1"
                                            Cursor="Hand"
                                            Command="{Binding SearchCommand}">
                                        <TextBlock Text="Tìm" Foreground="#FF111827" FontWeight="SemiBold" HorizontalAlignment="Center" VerticalAlignment="Center" />
                                    </Button>

                                    <TextBox Style="{StaticResource WatermarkTextBox}" Tag="Nhập email hoặc username"
                                             Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                                             BorderThickness="0" Background="Transparent" Foreground="#FF111827"
                                             FontSize="13" VerticalContentAlignment="Center" Padding="0">
                                        <TextBox.InputBindings>
                                            <KeyBinding Key="Enter" Command="{Binding SearchCommand}" />
                                        </TextBox.InputBindings>
                                    </TextBox>
                                </DockPanel>
                            </Border>

                            <Border Grid.Row="1" Background="Transparent" Margin="0,12,0,0">
                                <Grid>
                                    <ListBox ItemsSource="{Binding Results}" SelectedItem="{Binding SelectedUser}"
                                             BorderThickness="0" Background="Transparent"
                                             ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                                             ScrollViewer.VerticalScrollBarVisibility="Auto">
                                        <ListBox.ItemContainerStyle>
                                            <Style TargetType="ListBoxItem">
                                                <Setter Property="Padding" Value="0" />
                                                <Setter Property="Margin" Value="0,0,0,6" />
                                                <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                                                <Setter Property="Template">
                                                    <Setter.Value>
                                                        <ControlTemplate TargetType="ListBoxItem">
                                                            <Border x:Name="ItemBorder" CornerRadius="12" Background="#FFF9FAFB" BorderBrush="#FFE5E7EB" BorderThickness="1" Padding="8">
                                                                <ContentPresenter />
                                                            </Border>
                                                            <ControlTemplate.Triggers>
                                                                <Trigger Property="IsSelected" Value="True">
                                                                    <Setter TargetName="ItemBorder" Property="Background" Value="#FFE0EAFF" />
                                                                    <Setter TargetName="ItemBorder" Property="BorderBrush" Value="#FFBBD2FF" />
                                                                </Trigger>
                                                            </ControlTemplate.Triggers>
                                                        </ControlTemplate>
                                                    </Setter.Value>
                                                </Setter>
                                            </Style>
                                        </ListBox.ItemContainerStyle>

                                        <ListBox.ItemTemplate>
                                            <DataTemplate>
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="48" />
                                                        <ColumnDefinition Width="*" />
                                                    </Grid.ColumnDefinitions>

                                                    <Border Width="40" Height="40" CornerRadius="20" Background="#FFE5E7EB" VerticalAlignment="Center">
                                                        <TextBlock Text="{Binding AvatarText}" FontWeight="SemiBold" Foreground="#FF111827"
                                                                   HorizontalAlignment="Center" VerticalAlignment="Center" />
                                                    </Border>

                                                    <StackPanel Grid.Column="1" Margin="10,0,0,0" VerticalAlignment="Center">
                                                        <TextBlock Text="{Binding DisplayName}" FontWeight="SemiBold" Foreground="#FF111827" TextTrimming="CharacterEllipsis" />
                                                        <TextBlock Text="{Binding Subtitle}" Foreground="#FF6B7280" FontSize="12" TextTrimming="CharacterEllipsis" />
                                                    </StackPanel>
                                                </Grid>
                                            </DataTemplate>
                                        </ListBox.ItemTemplate>
                                    </ListBox>

                                    <TextBlock Text="{Binding StatusText}" Foreground="#FF6B7280" FontSize="12"
                                               VerticalAlignment="Bottom" Margin="2,8,2,0" />
                                </Grid>
                            </Border>

                            <Grid Grid.Row="2" Margin="0,12,0,0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>

                                <TextBlock Text="" />

                                <Button Grid.Column="1"
                                        Width="140" Height="36"
                                        Background="#FF2563EB" Foreground="White"
                                        BorderThickness="0" Cursor="Hand"
                                        Command="{Binding SendFriendRequestCommand}"
                                        IsEnabled="{Binding CanSend}">
                                    <Button.Template>
                                        <ControlTemplate TargetType="Button">
                                            <Border Background="{TemplateBinding Background}" CornerRadius="999">
                                                <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" />
                                            </Border>
                                        </ControlTemplate>
                                    </Button.Template>
                                    <TextBlock Text="Gửi lời mời" FontWeight="SemiBold" />
                                </Button>
                            </Grid>
                        </Grid>
                    </TabItem>

                    <TabItem Header="Lời mời">
                        <Grid Margin="0,8,0,0">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="*" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>

                            <Border Grid.Row="0" Background="White" CornerRadius="12" Padding="10" BorderBrush="#FFE5E7EB" BorderThickness="1">
                                <DockPanel LastChildFill="True">
                                    <TextBlock Text="Lời mời kết bạn" Foreground="#FF111827" FontWeight="SemiBold" VerticalAlignment="Center" />
                                    <Button DockPanel.Dock="Right"
                                            Width="84" Height="28" Margin="8,0,0,0"
                                            Background="#FFF9FAFB" BorderBrush="#FFE5E7EB" BorderThickness="1"
                                            Cursor="Hand"
                                            Command="{Binding RefreshRequestsCommand}">
                                        <TextBlock Text="Tải lại" Foreground="#FF111827" FontWeight="SemiBold" HorizontalAlignment="Center" VerticalAlignment="Center" />
                                    </Button>
                                </DockPanel>
                            </Border>

                            <Border Grid.Row="1" Background="Transparent" Margin="0,12,0,0">
                                <Grid>
                                    <ListBox ItemsSource="{Binding PendingRequests}"
                                             BorderThickness="0" Background="Transparent"
                                             ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                                             ScrollViewer.VerticalScrollBarVisibility="Auto">
                                        <ListBox.ItemContainerStyle>
                                            <Style TargetType="ListBoxItem">
                                                <Setter Property="Padding" Value="0" />
                                                <Setter Property="Margin" Value="0,0,0,6" />
                                                <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                                                <Setter Property="Template">
                                                    <Setter.Value>
                                                        <ControlTemplate TargetType="ListBoxItem">
                                                            <Border CornerRadius="12" Background="#FFF9FAFB" BorderBrush="#FFE5E7EB" BorderThickness="1" Padding="8">
                                                                <ContentPresenter />
                                                            </Border>
                                                        </ControlTemplate>
                                                    </Setter.Value>
                                                </Setter>
                                            </Style>
                                        </ListBox.ItemContainerStyle>

                                        <ListBox.ItemTemplate>
                                            <DataTemplate>
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="48" />
                                                        <ColumnDefinition Width="*" />
                                                        <ColumnDefinition Width="Auto" />
                                                        <ColumnDefinition Width="Auto" />
                                                    </Grid.ColumnDefinitions>

                                                    <Border Width="40" Height="40" CornerRadius="20" Background="#FFE5E7EB" VerticalAlignment="Center">
                                                        <TextBlock Text="{Binding AvatarText}" FontWeight="SemiBold" Foreground="#FF111827"
                                                                   HorizontalAlignment="Center" VerticalAlignment="Center" />
                                                    </Border>

                                                    <StackPanel Grid.Column="1" Margin="10,0,8,0" VerticalAlignment="Center">
                                                        <TextBlock Text="{Binding DisplayName}" FontWeight="SemiBold" Foreground="#FF111827" TextTrimming="CharacterEllipsis" />
                                                        <TextBlock Text="{Binding Subtitle}" Foreground="#FF6B7280" FontSize="12" TextTrimming="CharacterEllipsis" />
                                                    </StackPanel>

                                                    <Button Grid.Column="2" Width="86" Height="28" Margin="0,0,6,0"
                                                            Background="#FF2563EB" Foreground="White" BorderThickness="0" Cursor="Hand"
                                                            Command="{Binding DataContext.AcceptRequestCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                            CommandParameter="{Binding}">
                                                        <Button.Template>
                                                            <ControlTemplate TargetType="Button">
                                                                <Border Background="{TemplateBinding Background}" CornerRadius="999">
                                                                    <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" />
                                                                </Border>
                                                            </ControlTemplate>
                                                        </Button.Template>
                                                        <TextBlock Text="Chấp nhận" FontWeight="SemiBold" />
                                                    </Button>

                                                    <Button Grid.Column="3" Width="72" Height="28"
                                                            Background="#FFF9FAFB" BorderBrush="#FFE5E7EB" BorderThickness="1" Cursor="Hand"
                                                            Command="{Binding DataContext.DeclineRequestCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                            CommandParameter="{Binding}">
                                                        <TextBlock Text="Từ chối" Foreground="#FF111827" FontWeight="SemiBold" />
                                                    </Button>
                                                </Grid>
                                            </DataTemplate>
                                        </ListBox.ItemTemplate>
                                    </ListBox>

                                    <TextBlock Text="{Binding RequestsStatusText}" Foreground="#FF6B7280" FontSize="12"
                                               VerticalAlignment="Bottom" Margin="2,8,2,0" />
                                </Grid>
                            </Border>

                            <TextBlock Grid.Row="2" Text="" />
                        </Grid>
                    </TabItem>
                </TabControl>
            </Grid>
        </Border>
    </Grid>
</Window>
